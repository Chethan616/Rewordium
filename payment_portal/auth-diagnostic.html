<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Auth Diagnostic</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #ddd; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .loading { background: #fff3cd; border-color: #ffeaa7; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>ğŸ” Firebase Authentication Diagnostic</h1>
    
    <div id="status" class="test loading">
        â³ Initializing Firebase...
    </div>
    
    <div class="test">
        <h3>Authentication Tests</h3>
        <button onclick="testEmailSignUp()">Test Email Sign Up</button>
        <button onclick="testEmailSignIn()">Test Email Sign In</button>
        <button onclick="testGoogleSignIn()">Test Google Sign In</button>
        <button onclick="testFirestoreWrite()">Test Firestore Write</button>
        <button onclick="listUsers()">List Current Users</button>
    </div>
    
    <div id="results"></div>
    
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBoG1w3GaQVy2O6kjp-ZQw09TZgbUWjrTg",
            authDomain: "rewordium.firebaseapp.com",
            projectId: "rewordium",
            storageBucket: "rewordium.firebasestorage.app",
            messagingSenderId: "1046215732414",
            appId: "1:1046215732414:android:a97ddde5e4953c46ab02ef"
        };
        
        let auth = null;
        let db = null;
        
        // Initialize Firebase
        function initFirebase() {
            try {
                if (typeof firebase !== 'undefined') {
                    firebase.initializeApp(firebaseConfig);
                    auth = firebase.auth();
                    db = firebase.firestore();
                    
                    updateStatus('âœ… Firebase initialized successfully', 'success');
                    
                    // Listen for auth state changes
                    auth.onAuthStateChanged((user) => {
                        if (user) {
                            addResult(`ğŸ”„ User authenticated: ${user.email || user.uid}`);
                        } else {
                            addResult('ğŸ”„ User signed out');
                        }
                    });
                    
                } else {
                    updateStatus('âŒ Firebase SDK not loaded', 'error');
                }
            } catch (error) {
                updateStatus('âŒ Firebase initialization failed: ' + error.message, 'error');
            }
        }
        
        function updateStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = 'test ' + type;
        }
        
        function addResult(message) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = 'test';
            div.textContent = new Date().toLocaleTimeString() + ': ' + message;
            results.appendChild(div);
        }
        
        // Test email sign up
        async function testEmailSignUp() {
            if (!auth) {
                addResult('âŒ Firebase Auth not initialized');
                return;
            }
            
            const email = 'test' + Date.now() + '@example.com';
            const password = 'testPassword123';
            
            try {
                addResult('ğŸ”„ Testing email sign up with: ' + email);
                const result = await auth.createUserWithEmailAndPassword(email, password);
                addResult('âœ… Email sign up successful: ' + result.user.uid);
                
                // Create user document
                await createUserDocument(result.user);
                
            } catch (error) {
                addResult('âŒ Email sign up failed: ' + error.message);
            }
        }
        
        // Test email sign in
        async function testEmailSignIn() {
            if (!auth) {
                addResult('âŒ Firebase Auth not initialized');
                return;
            }
            
            const email = 'test@example.com';
            const password = 'testPassword123';
            
            try {
                addResult('ğŸ”„ Testing email sign in with: ' + email);
                const result = await auth.signInWithEmailAndPassword(email, password);
                addResult('âœ… Email sign in successful: ' + result.user.uid);
                
            } catch (error) {
                addResult('âŒ Email sign in failed: ' + error.message);
            }
        }
        
        // Test Google sign in
        async function testGoogleSignIn() {
            if (!auth) {
                addResult('âŒ Firebase Auth not initialized');
                return;
            }
            
            try {
                addResult('ğŸ”„ Testing Google sign in...');
                const provider = new firebase.auth.GoogleAuthProvider();
                provider.addScope('profile');
                provider.addScope('email');
                
                const result = await auth.signInWithPopup(provider);
                addResult('âœ… Google sign in successful: ' + result.user.email);
                
                // Create user document
                await createUserDocument(result.user);
                
            } catch (error) {
                addResult('âŒ Google sign in failed: ' + error.message);
                console.error('Google sign in error details:', error);
            }
        }
        
        // Create user document
        async function createUserDocument(user) {
            if (!db) {
                addResult('âŒ Firestore not initialized');
                return;
            }
            
            try {
                const userDoc = {
                    name: user.displayName || user.email || 'Anonymous',
                    email: user.email || '',
                    isPro: false,
                    credits: 20,
                    signInMethod: user.providerData[0]?.providerId || 'email',
                    planType: 'free',
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                await db.collection('users').doc(user.uid).set(userDoc, { merge: true });
                addResult('âœ… User document created in Firestore');
                
            } catch (error) {
                addResult('âŒ Failed to create user document: ' + error.message);
            }
        }
        
        // Test Firestore write
        async function testFirestoreWrite() {
            if (!db) {
                addResult('âŒ Firestore not initialized');
                return;
            }
            
            try {
                addResult('ğŸ”„ Testing Firestore write...');
                const testDoc = {
                    test: true,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    random: Math.random()
                };
                
                await db.collection('_test').add(testDoc);
                addResult('âœ… Firestore write successful');
                
            } catch (error) {
                addResult('âŒ Firestore write failed: ' + error.message);
            }
        }
        
        // List current users (from auth state)
        function listUsers() {
            if (!auth) {
                addResult('âŒ Firebase Auth not initialized');
                return;
            }
            
            const user = auth.currentUser;
            if (user) {
                addResult('ğŸ‘¤ Current user: ' + (user.email || user.uid));
                addResult('ğŸ”‘ UID: ' + user.uid);
                addResult('ğŸ“§ Email: ' + (user.email || 'No email'));
                addResult('âœ… Email verified: ' + user.emailVerified);
            } else {
                addResult('âŒ No user currently signed in');
            }
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(initFirebase, 1000);
        });
    </script>
</body>
</html>
